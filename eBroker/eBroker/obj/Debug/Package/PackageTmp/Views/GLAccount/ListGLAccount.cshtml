@model IEnumerable<eBroker.GL_Account>
@{
    ViewBag.Title = "Chart of Accounts";
}
@if (Model != null && Model.Any())
{
    <div>
        <div class="box box-primary">
            <div class="box-header with-border">
                <h4>
                    <i class="fa fa-line-chart"></i>
                    Charts of Account [@Model.Count()]
                </h4>
            </div>
            <div class="box-body">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Ledger No</th>
                            <th>Ledger Description</th>
                            <th>Ledger Type</th>
                            <th>Parent Ledger No</th>
                            <th>Level</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.Where(x => x.GL_Level == 1).ToList())
                        {
                            <tr class="header">
                                <td>@item.LedgerNo</td>
                                <td>@item.LedgerDescription</td>
                                <td>@item.LedgerType</td>
                                <td>@item.ParentLedgerNo</td>
                                <td class="collape">@item.GL_Level</td>
                            </tr>
                            foreach (var subitem in Model.Where(x => x.GL_Level == 2 && x.ParentLedgerNo == item.LedgerNo).ToList())
                            {
                                <tr class="subheader bg-success">
                                    <td>@subitem.LedgerNo</td>
                                    <td>@subitem.LedgerDescription</td>
                                    <td>@subitem.LedgerType</td>
                                    <td>@subitem.ParentLedgerNo</td>
                                    <td class="subcollape">@subitem.GL_Level</td>
                                </tr>
                                foreach (var sub3item in Model.Where(x => x.GL_Level == 3 && x.ParentLedgerNo == subitem.LedgerNo).ToList())
                                {
                                    <tr class="subheader2" style="visibility: collapse;">
                                        <td>@sub3item.LedgerNo</td>
                                        <td>@sub3item.LedgerDescription</td>
                                        <td>@sub3item.LedgerType</td>
                                        <td>@sub3item.ParentLedgerNo</td>
                                        <td>@sub3item.GL_Level</td>
                                    </tr>
                                }
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <style type="text/css">
        .table > tbody > tr.active > td,
        .table > tbody > tr.active > th,
        .table > tbody > tr > td.active,
        .table > tbody > tr > th.active,
        .table > tfoot > tr.active > td,
        .table > tfoot > tr.active > th,
        .table > tfoot > tr > td.active,
        .table > tfoot > tr > th.active,
        .table > thead > tr.active > td,
        .table > thead > tr.active > th,
        .table > thead > tr > td.active,
        .table > thead > tr > th.active {
            background-color: #CCC;
        }

        .table-bordered > tbody > tr > td,
        .table-bordered > tbody > tr > th,
        .table-bordered > tfoot > tr > td,
        .table-bordered > tfoot > tr > th,
        .table-bordered > thead > tr > td,
        .table-bordered > thead > tr > th {
            border-color: #e4e5e7;
        }

        .table tr.header {
            font-weight: bold;
            background-color: #fff;
            cursor: pointer;
            -webkit-user-select: none;
            /* Chrome all / Safari all */
            -moz-user-select: none;
            /* Firefox all */
            -ms-user-select: none;
            /* IE 10+ */
            user-select: none;
            /* Likely future */
        }

        .table tr.subheader {
            font-weight: bold;
/*            background-color: #fff;*/
            cursor: pointer;
            -webkit-user-select: none;
            /* Chrome all / Safari all */
            -moz-user-select: none;
            /* Firefox all */
            -ms-user-select: none;
            /* IE 10+ */
            user-select: none;
            /* Likely future */
        }

        .subheader {
            display: none;
        }

        .subheader2 {
            display: none;
        }

        .table .header .collape:after {
            content: "\002b";
            position: relative;
            top: 1px;
            display: inline-block;
            font-family: 'Glyphicons Halflings';
            font-style: normal;
            font-weight: 400;
            line-height: 1;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            float: right;
            color: #000;
            text-align: center;
            padding: 3px;
            transition: transform .25s linear;
            -webkit-transition: -webkit-transform .25s linear;
        }

        .table .subcollape:after {
            content: "\002b";
            position: relative;
            top: 1px;
            display: inline-block;
            font-family: 'Glyphicons Halflings';
            font-style: normal;
            font-weight: 400;
            line-height: 1;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            float: right;
            color: #000;
            text-align: center;
            padding: 3px;
            transition: transform .25s linear;
            -webkit-transition: -webkit-transform .25s linear;
        }

        .table .header.active .collape:after {
            content: "\2212";
        }

        .table .subheader.active .subcollape:after {
            content: "\2212";
        }
    </style>
    <script type="text/javascript">
        $(document).ready(function () {
            var ua = navigator.userAgent,
              event = (ua.match(/iPad/i)) ? "touchstart" : "click";
            if ($('.table').length > 0) {
                $('.table .header').on(event, function () {
                    $(this).toggleClass("active", "").nextUntil('.header').css('display', function (i, v) {

                        return this.style.display === 'table-row' ? 'none' : 'table-row';
                        
                    });
                    
                });
            }
            if ($('.table .header').length > 0) {
                $('.table .subheader').on(event, function () {
                    $(this).toggleClass("active", "").nextUntil('.subheader').css('visibility', function (i, v) {

                        return this.style.visibility === 'collapse' ? 'visible' : 'collapse';

                    });

                });
            }
        })
    </script>
}
